#!/usr/bin/env bash

## Copyright (C) 2020-2022 Aditya Shakya <adi1090x@gmail.com>
## Everyone is permitted to copy and distribute copies of this file under GNU-GPL3

CFGDIR="$HOME/.config"
BSPDIR="$CFGDIR/bspwm"
THEMEDIR="$BSPDIR/themes"
XFILE="$BSPDIR/xsettingsd"
XRES="$HOME/.Xresources.d"
geany_path="$HOME/.config/geany"
BSP="$HOME/.config/bspwm"

rofi_cmd="rofi -theme $BSPDIR/rofi/themes/themes.rasi"

# Themes
theme_1=" Cyberpunk"
theme_2=" Wave"
theme_3=" Catppucinn"
theme_4=" Satanic"
theme_5=" Emilia"
theme_6=" Forest"
theme_7=" Aline"

# Variable passed to rofi
options="$theme_1\n$theme_2\n$theme_3\n$theme_4\n$theme_5\n$theme_6\n$theme_7"

## Apply theme
set_style() {
	# apply color-scheme
	# ----- apply color-scheme ----- #
	cat "$BSP"/themes/${1} > "$XRES"/colors
	
	# set gtk theme, icons and cursor
	
	sed -i -e "s|Net/ThemeName .*|Net/ThemeName \"$2\"|g" ${XFILE}
	sed -i -e "s|Net/IconThemeName .*|Net/IconThemeName \"$3\"|g" ${XFILE}
	sed -i -e "s|Gtk/CursorThemeName .*|Gtk/CursorThemeName \"$4\"|g" ${XFILE}
	
	sed -i -e "s/gtk-theme-name=.*/gtk-theme-name=\"$2\"/g" ${HOME}/.gtkrc-2.0
	sed -i -e "s/gtk-icon-theme-name=.*/gtk-icon-theme-name=\"$3\"/g" ${HOME}/.gtkrc-2.0
	sed -i -e "s/gtk-cursor-theme-name=.*/gtk-cursor-theme-name=\"$4\"/g" ${HOME}/.gtkrc-2.0
		
	sed -i -e "s/gtk-theme-name=.*/gtk-theme-name=$2/g" ${CFGDIR}/gtk-3.0/settings.ini
	sed -i -e "s/gtk-icon-theme-name=.*/gtk-icon-theme-name=$3/g" ${CFGDIR}/gtk-3.0/settings.ini
	sed -i -e "s/gtk-cursor-theme-name=.*/gtk-cursor-theme-name=$4/g" ${CFGDIR}/gtk-3.0/settings.ini
	
	sed -i -e "s/Inherits=.*/Inherits=$4/g" ${HOME}/.icons/default/index.theme
	
	# set wallpaper
	feh --bg-fill /usr/share/backgrounds/${1}.jpg
	#sed -i -e "s/file=.*/file=\/usr\/share\/backgrounds\/${1}.jpg/g" ${CFGDIR}/nitrogen/bg-saved.cfg
	
	# set geany
	sed -i -e "s/color_scheme=.*/color_scheme=$1.conf/g" ${geany_path}/geany.conf
	#sed -i -e "s/editor_font=.*/editor_font=$2/g" 			${geany_path}/geany.conf
	
	# ----- launch Polybar ----- #
	echo "$1">~/.config/bspwm/selectedThemeName
	
	# ----- apply color-scheme ----- #
	cat "$BSP"/themes/${1} > "$XRES"/colors
	
	## Change conkeww colors file.
	sed -i "s/colors\/color-.*/colors\/color-${1}.yuck\")/g" $HOME/.config/conkeww/eww.yuck
	
	# set rofi launcher and theme selector image
	sed -i "s/background-image:.*/background-image: url(\"~\/.config\/bspwm\/assets\/launcher-${1}.webp\", width);/g" ${HOME}/.config/bspwm/rofi/themes/launcher.rasi
	sed -i "s/background-image:.*/background-image: url(\"~\/.config\/bspwm\/assets\/launcher-${1}.webp\", width);/g" ${HOME}/.config/bspwm/rofi/themes/themes.rasi
    
    # reload bspwm
    pkill polybar
	bspc wm -r
	
}

##              "${1} bg+themeName+conkeww"  "gtk theme"  "$3 icons"  "cursor"  "polybar"   "geany"
chosen="$(echo -e "$options" | $rofi_cmd -p "Available themes : (20 + ∞)" -dmenu -selected-row 0)"
case $chosen in
    $theme_1)
        set_style  'cyberpunk' 'Dracula' 'Luna-Purple-Dark' 'LyraB'
        ;;
    $theme_2)
        set_style  'wave' 'Wave' 'Luv-Folders-Dark' 'Vimix'
        ;;
    $theme_3)
        set_style  'catppuccin' 'Catppuccin-Frappe-Teal' 'Papirus-Dark' 'Vimix-Dark'
        ;;
    $theme_4)
        set_style  'satanic' 'Satanic' 'Luna-Red-Dark' 'LyraS'
        ;;
    $theme_5)
        set_style  'emilia' 'Catppuccin-Mocha-Red' 'Luna-Antidote-Dark' 'Vimix-Dark'
        ;;
    $theme_6)
        set_style  'forest' 'Adapta-Nokto' 'Luna-Green-Dark' 'Pear'
        ;;
    $theme_7)
        set_style  'aline' 'Catppuccin-Latte-Mauve' 'Win11' 'Sweet'
        ;;
esac
